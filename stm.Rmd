---
title: "R Notebook"
output: html_notebook
---

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. 

Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Cmd+Shift+Enter*. 

```{r}
## Installs
install.packages("stm")
install.packages("quanteda")
install.packages("spacyr")
install.packages("wordcloud")

## Imports


library(jsonlite)
library(stm)
library(quanteda)
library(spacyr)
library(stringr)
library(wordcloud)
library(ggplot2)

```

```{r}
gender_func <- function(gender_label){
  if(gender_label == "woman"){
    return("Female")
  } else if(gender_label == "man") {
    return("Male")
  } else {
    return("other")
  }
}

w_vs <- function(eth_label){
  if(eth_label == 'white'){
    return("White")
  } else {
    return("Not White")
  }
}
a_vs <- function(eth_label){
  if(eth_label == 'asian'){
    return("Asian")
  } else {
    return("Not Asian")
  }
}

b_vs <- function(eth_label){
  if(eth_label == 'black'){
    return("African American")
  } else {
    return("Not African American")
  }
}
h_vs <- function(eth_label){
  if(eth_label == 'hispanic'){
    return("Hispanic")
  } else {
    return("Not Hispanic")
  }
}
```


```{r}
# survey_meta <- read.csv("/Users/shinkamori/Documents/Research/p2345.csv")
survey_meta <- read.csv("/Users/shinkamori/Documents/Research/p2_p4_p5_p6_p7.csv")
survey_meta <- read.csv("/Users/shinkamori/Documents/Research/p4_5_6_7.csv")
survey_meta$gender <- sapply(survey_meta$gender, gender_func)
# survey_meta$w_vs <- sapply(survey_meta$race, w_vs)
# survey_meta$a_vs <- sapply(survey_meta$race, a_vs)
# survey_meta$b_vs <- sapply(survey_meta$race, b_vs)
# survey_meta$h_vs <- sapply(survey_meta$race, h_vs)

# survey_meta <- survey_meta[, c("text", "gender", "race")]
```
```{r}
summary(survey_meta)
```
```{r}
head(survey_metagit merge origin)
```

```{r}
sapply(lapply(survey_meta, unique), length)
```


```{r}
processed <- textProcessor(survey_meta$text, metadata=survey_meta[, c( "gender", "race")])
out <- prepDocuments(processed$documents, processed$vocab, processed$meta)
```
```{r}
sapply(lapply(processed$meta, unique), length)

```
```{r}
temp_text <- survey_meta[-processed$docs.removed,]

```
```{r}
length(temp_text)
```
```{r}
model_depression_race <- stm::stm(
  documents = out_race$documents,
  K = 25,
  prevalence =~ gender + w_vs ,
  data=out_race$meta,
  vocab = out_race$vocab,
  max.em.its=75
)


```
```{r}
model_depression_race_2 <- stm::stm(
  documents = out_race$documents,
  K = 25,
  prevalence =~ gender + race ,
  data=out_race$meta,
  vocab = out_race$vocab,
  max.em.its=75
)

```


```{r}
model_depression <- stm::stm(
  documents = out$documents,
  K = 25,
  prevalence =~ gender + race,
  data=out$meta,
  vocab = out$vocab,
  max.em.its=75
)
```
```{r}
labelTopics(model_depression_race_2, n = 30)

```
```{r}
labelTopics(model_depression, n = 30)

```

```{r}
labelTopics(model_depression, n = 30)

```
```{r}
findThoughts(model_depression, texts = survey_meta$text,topics = 4)# plots cloud of most important words

```

```{r}
labelTopics(model_depression, topics = 25, n=30)
findThoughts(model_depression, texts = survey_meta$text,topics = 25)# plots cloud of most important words
cloud(model_depression, 25)
# plotQuote(thoughts, width = 30, main = "Topic 2")
```
```{r}
prep_gender <- stm::estimateEffect(~ gender, 
                                   model_depression,
                                   meta = survey_meta[, c( "gender", "race")], uncertainty = "Global")

prep_eth <- stm::estimateEffect(~ race,
                                model_depression,
                                meta = survey_meta[, c( "gender", "race")], uncertainty = "Global")
prep_w_vs <- stm::estimateEffect(~ w_vs,
                                model_depression,
                                meta = survey_meta[, c( "gender", "race")], uncertainty = "Global")
```



```{r}
# topics <- c("finances, relationships", "feeling stuck", "politics and news","talent and success?", "high pressure from work", "work life balance", "police brutality??", "stressors related to asian indiv", "finance and stress from job", "racism, discrimination", "feeling inadequate, comparing to others", "???-1", "loneliness and isolation","insecurities rooted in prejudice", "feeling aimless, lack of purpose", "family, stressors related to hispanic indiv", "providing for family", "words to describe mental state?", "mental health", "frustration, physical reactions", " mistakes, disappointment, probing your worth", "???-2", "stress related to manual labor", "Lack of control", "sexism, racism, money")
# topics <- c("making mistakes", "relationship", "working long hours", "helplessness", "race words", "finances - family", "family - tradition", "comparing to others", "???9", "pressure form job", "unemployment", "racism", "???13", "work relatonship", "ovewhelmed from work", "???16", "helplessness", "???18", "???19", "fighting discrimination", "physical stress", "concern for future", "stress", "overworked", "loneliness")
topics <- c("making mistakes", "relationship", "working long hours", "helplessness", "race words", "finances - family", "family - tradition", "comparing to others", "pressure form job", "unemployment", "racism",  "work relatonship", "ovewhelmed from work", "helplessness", "fighting discrimination", "physical stress", "concern for future", "stress", "overworked", "loneliness")
topic_names = c(1,2,3,4,5,6,7,8,10,11,12,14,15,17,20,21,22,23,24,25)


```

```{r}
plot(model_depression, type = "summary", xlim = c(0, 0.3))
plot(prep_gender, covariate = "gender", model = model_depression, method = "difference", 
     cov.value1 = "Male", cov.value2 = "Female",
     xlab = "More Female ... More Male",
     labeltype = "custom",
     custom.labels = topics,
     xlim = c(-0.1, 0.1),
     topics = topic_names,
     main = "Effect of Gender")


```

```{r}
plot(prep_eth, covariate = "race", model = model_depression, method = "difference", 
     cov.value1 = "White", cov.value2 = "PoC",
     xlab = "More PoC ... More White",
     labeltype = "custom",
     custom.labels = topics,
     xlim = c(-0.05, 0.05),
     ylim = c(0, 20),
     topics = topic_names,
     main = "Effect of Race")


```

```{r}
plot(prep_eth, covariate = "race", model = model_depression, method = "difference", 
     cov.value1 = "white", cov.value2 = "black",
     xlab = "More African American ... More white",
     labeltype = "custom",
     custom.labels = topics,
     topics = topic_names,
     xlim = c(-0.20, 0.20),
     )
plot(prep_eth, covariate = "race", model = model_depression, method = "difference", 
     cov.value1 = "white", cov.value2 = "asian",
     xlab = "More Asian ... More white",
     labeltype = "custom",
     custom.labels = topics,
     topics = topic_names,
     xlim = c(-0.20, 0.20),
     )
plot(prep_eth, covariate = "race", model = model_depression, method = "difference", 
     cov.value1 = "white", cov.value2 = "hispanic",
     xlab = "More hispanic ... More white",
     labeltype = "custom",
     custom.labels = topics,
     topics = topic_names,
     xlim = c(-0.20, 0.20),
     )


```

---
title: "R Notebook"
output: html_notebook
---

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. 

Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Cmd+Shift+Enter*. 

```{r}
## Installs
install.packages("stm")
install.packages("quanteda")
install.packages("spacyr")
install.packages("wordcloud")

## Imports


library(jsonlite)
library(stm)
library(quanteda)
library(spacyr)
library(stringr)
library(wordcloud)
library(ggplot2)

```

```{r}
gender_func <- function(gender_label){
  if(gender_label == "woman"){
    return("Female")
  } else if(gender_label == "man") {
    return("Male")
  } else {
    return("other")
  }
}

w_vs <- function(eth_label){
  if(eth_label == 'white'){
    return("White")
  } else {
    return("Not White")
  }
}
a_vs <- function(eth_label){
  if(eth_label == 'asian'){
    return("Asian")
  } else {
    return("Not Asian")
  }
}

b_vs <- function(eth_label){
  if(eth_label == 'black'){
    return("African American")
  } else {
    return("Not African American")
  }
}
h_vs <- function(eth_label){
  if(eth_label == 'hispanic'){
    return("Hispanic")
  } else {
    return("Not Hispanic")
  }
}
```


```{r}
# survey_meta <- read.csv("/Users/shinkamori/Documents/Research/p2345.csv")
survey_meta <- read.csv("/Users/shinkamori/Documents/Research/p2_p4_p5_p6_p7.csv")
survey_meta <- read.csv("/Users/shinkamori/Documents/Research/p4_5_6_7.csv")
survey_meta$gender <- sapply(survey_meta$gender, gender_func)
# survey_meta$w_vs <- sapply(survey_meta$race, w_vs)
# survey_meta$a_vs <- sapply(survey_meta$race, a_vs)
# survey_meta$b_vs <- sapply(survey_meta$race, b_vs)
# survey_meta$h_vs <- sapply(survey_meta$race, h_vs)

# survey_meta <- survey_meta[, c("text", "gender", "race")]
```
```{r}
summary(survey_meta)
```
```{r}
head(survey_metagit merge origin)
```

```{r}
sapply(lapply(survey_meta, unique), length)
```


```{r}
processed <- textProcessor(survey_meta$text, metadata=survey_meta[, c( "gender", "race")])
out <- prepDocuments(processed$documents, processed$vocab, processed$meta)
```
```{r}
sapply(lapply(processed$meta, unique), length)

```
```{r}
temp_text <- survey_meta[-processed$docs.removed,]

```
```{r}
length(temp_text)
```
```{r}
model_depression_race <- stm::stm(
  documents = out_race$documents,
  K = 25,
  prevalence =~ gender + w_vs ,
  data=out_race$meta,
  vocab = out_race$vocab,
  max.em.its=75
)


```
```{r}
model_depression_race_2 <- stm::stm(
  documents = out_race$documents,
  K = 25,
  prevalence =~ gender + race ,
  data=out_race$meta,
  vocab = out_race$vocab,
  max.em.its=75
)

```


```{r}
model_depression <- stm::stm(
  documents = out$documents,
  K = 25,
  prevalence =~ gender + race,
  data=out$meta,
  vocab = out$vocab,
  max.em.its=75
)
```
```{r}
labelTopics(model_depression_race_2, n = 30)

```
```{r}
labelTopics(model_depression, n = 30)

```

```{r}
labelTopics(model_depression, n = 30)

```
```{r}
findThoughts(model_depression, texts = survey_meta$text,topics = 4)# plots cloud of most important words

```

```{r}
labelTopics(model_depression, topics = 25, n=30)
findThoughts(model_depression, texts = survey_meta$text,topics = 25)# plots cloud of most important words
cloud(model_depression, 25)
# plotQuote(thoughts, width = 30, main = "Topic 2")
```
```{r}
prep_gender <- stm::estimateEffect(~ gender, 
                                   model_depression,
                                   meta = survey_meta[, c( "gender", "race")], uncertainty = "Global")

prep_eth <- stm::estimateEffect(~ race,
                                model_depression,
                                meta = survey_meta[, c( "gender", "race")], uncertainty = "Global")
prep_w_vs <- stm::estimateEffect(~ w_vs,
                                model_depression,
                                meta = survey_meta[, c( "gender", "race")], uncertainty = "Global")
```



```{r}
# topics <- c("finances, relationships", "feeling stuck", "politics and news","talent and success?", "high pressure from work", "work life balance", "police brutality??", "stressors related to asian indiv", "finance and stress from job", "racism, discrimination", "feeling inadequate, comparing to others", "???-1", "loneliness and isolation","insecurities rooted in prejudice", "feeling aimless, lack of purpose", "family, stressors related to hispanic indiv", "providing for family", "words to describe mental state?", "mental health", "frustration, physical reactions", " mistakes, disappointment, probing your worth", "???-2", "stress related to manual labor", "Lack of control", "sexism, racism, money")
# topics <- c("making mistakes", "relationship", "working long hours", "helplessness", "race words", "finances - family", "family - tradition", "comparing to others", "???9", "pressure form job", "unemployment", "racism", "???13", "work relatonship", "ovewhelmed from work", "???16", "helplessness", "???18", "???19", "fighting discrimination", "physical stress", "concern for future", "stress", "overworked", "loneliness")
topics <- c("making mistakes", "relationship", "working long hours", "helplessness", "race words", "finances - family", "family - tradition", "comparing to others", "pressure form job", "unemployment", "racism",  "work relatonship", "ovewhelmed from work", "helplessness", "fighting discrimination", "physical stress", "concern for future", "stress", "overworked", "loneliness")
topic_names = c(1,2,3,4,5,6,7,8,10,11,12,14,15,17,20,21,22,23,24,25)


```

```{r}
plot(model_depression, type = "summary", xlim = c(0, 0.3))
plot(prep_gender, covariate = "gender", model = model_depression, method = "difference", 
     cov.value1 = "Male", cov.value2 = "Female",
     xlab = "More Female ... More Male",
     labeltype = "custom",
     custom.labels = topics,
     xlim = c(-0.1, 0.1),
     topics = topic_names,
     main = "Effect of Gender")


```

```{r}
plot(prep_eth, covariate = "race", model = model_depression, method = "difference", 
     cov.value1 = "White", cov.value2 = "PoC",
     xlab = "More PoC ... More White",
     labeltype = "custom",
     custom.labels = topics,
     xlim = c(-0.05, 0.05),
     ylim = c(0, 20),
     topics = topic_names,
     main = "Effect of Race")


```

```{r}
plot(prep_eth, covariate = "race", model = model_depression, method = "difference", 
     cov.value1 = "white", cov.value2 = "black",
     xlab = "More African American ... More white",
     labeltype = "custom",
     custom.labels = topics,
     topics = topic_names,
     xlim = c(-0.20, 0.20),
     )
plot(prep_eth, covariate = "race", model = model_depression, method = "difference", 
     cov.value1 = "white", cov.value2 = "asian",
     xlab = "More Asian ... More white",
     labeltype = "custom",
     custom.labels = topics,
     topics = topic_names,
     xlim = c(-0.20, 0.20),
     )
plot(prep_eth, covariate = "race", model = model_depression, method = "difference", 
     cov.value1 = "white", cov.value2 = "hispanic",
     xlab = "More hispanic ... More white",
     labeltype = "custom",
     custom.labels = topics,
     topics = topic_names,
     xlim = c(-0.20, 0.20),
     )


```

```{r}
toLDAvis(model_depression, out$documents)
```
```{r}
install.packages("LDAvis")

```


```{r}
plot(prep_eth, covariate = "race", model = model_depression, method = "difference", 
     cov.value1 = "asian", cov.value2 = "black",
     xlab = "More African American ... More Asian",
     labeltype = "custom",
     custom.labels = topics,
     
     xlim = c(-0.20, 0.20),
     )
plot(prep_eth, covariate = "race", model = model_depression, method = "difference", 
     cov.value1 = "hispanic", cov.value2 = "black",
     xlab = "More African American ... More Hispanic",
     labeltype = "custom",
     custom.labels = topics,
     xlim = c(-0.20, 0.20),
     )
plot(prep_eth, covariate = "race", model = model_depression, method = "difference", 
     cov.value1 = "white", cov.value2 = "black",
     xlab = "More African American ... More White",
     labeltype = "custom",
     custom.labels = topics,
     xlim = c(-0.20, 0.20),
     )


```

---
title: "R Notebook"
output: html_notebook
---

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. 

Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Cmd+Shift+Enter*. 

```{r}
## Installs
install.packages("stm")
install.packages("quanteda")
install.packages("spacyr")
install.packages("wordcloud")

## Imports


library(jsonlite)
library(stm)
library(quanteda)
library(spacyr)
library(stringr)
library(wordcloud)
library(ggplot2)

```

```{r}
gender_func <- function(gender_label){
  if(gender_label == "woman"){
    return("Female")
  } else if(gender_label == "man") {
    return("Male")
  } else {
    return("other")
  }
}

w_vs <- function(eth_label){
  if(eth_label == 'white'){
    return("White")
  } else {
    return("Not White")
  }
}
a_vs <- function(eth_label){
  if(eth_label == 'asian'){
    return("Asian")
  } else {
    return("Not Asian")
  }
}

b_vs <- function(eth_label){
  if(eth_label == 'black'){
    return("African American")
  } else {
    return("Not African American")
  }
}
h_vs <- function(eth_label){
  if(eth_label == 'hispanic'){
    return("Hispanic")
  } else {
    return("Not Hispanic")
  }
}
```


```{r}
# survey_meta <- read.csv("/Users/shinkamori/Documents/Research/p2345.csv")
survey_meta <- read.csv("/Users/shinkamori/Documents/Research/p2_p4_p5_p6_p7.csv")
survey_meta <- read.csv("/Users/shinkamori/Documents/Research/p4_5_6_7.csv")
survey_meta$gender <- sapply(survey_meta$gender, gender_func)
# survey_meta$w_vs <- sapply(survey_meta$race, w_vs)
# survey_meta$a_vs <- sapply(survey_meta$race, a_vs)
# survey_meta$b_vs <- sapply(survey_meta$race, b_vs)
# survey_meta$h_vs <- sapply(survey_meta$race, h_vs)

# survey_meta <- survey_meta[, c("text", "gender", "race")]
```
```{r}
summary(survey_meta)
```
```{r}
head(survey_metagit merge origin)
```

```{r}
sapply(lapply(survey_meta, unique), length)
```


```{r}
processed <- textProcessor(survey_meta$text, metadata=survey_meta[, c( "gender", "race")])
out <- prepDocuments(processed$documents, processed$vocab, processed$meta)
```
```{r}
sapply(lapply(processed$meta, unique), length)

```
```{r}
temp_text <- survey_meta[-processed$docs.removed,]

```
```{r}
length(temp_text)
```
```{r}
model_depression_race <- stm::stm(
  documents = out_race$documents,
  K = 25,
  prevalence =~ gender + w_vs ,
  data=out_race$meta,
  vocab = out_race$vocab,
  max.em.its=75
)


```
```{r}
model_depression_race_2 <- stm::stm(
  documents = out_race$documents,
  K = 25,
  prevalence =~ gender + race ,
  data=out_race$meta,
  vocab = out_race$vocab,
  max.em.its=75
)

```


```{r}
model_depression <- stm::stm(
  documents = out$documents,
  K = 25,
  prevalence =~ gender + race,
  data=out$meta,
  vocab = out$vocab,
  max.em.its=75
)
```
```{r}
labelTopics(model_depression_race_2, n = 30)

```
```{r}
labelTopics(model_depression, n = 30)

```

```{r}
labelTopics(model_depression, n = 30)

```
```{r}
findThoughts(model_depression, texts = survey_meta$text,topics = 4)# plots cloud of most important words

```

```{r}
labelTopics(model_depression, topics = 25, n=30)
findThoughts(model_depression, texts = survey_meta$text,topics = 25)# plots cloud of most important words
cloud(model_depression, 25)
# plotQuote(thoughts, width = 30, main = "Topic 2")
```
```{r}
prep_gender <- stm::estimateEffect(~ gender, 
                                   model_depression,
                                   meta = survey_meta[, c( "gender", "race")], uncertainty = "Global")

prep_eth <- stm::estimateEffect(~ race,
                                model_depression,
                                meta = survey_meta[, c( "gender", "race")], uncertainty = "Global")
prep_w_vs <- stm::estimateEffect(~ w_vs,
                                model_depression,
                                meta = survey_meta[, c( "gender", "race")], uncertainty = "Global")
```



```{r}
# topics <- c("finances, relationships", "feeling stuck", "politics and news","talent and success?", "high pressure from work", "work life balance", "police brutality??", "stressors related to asian indiv", "finance and stress from job", "racism, discrimination", "feeling inadequate, comparing to others", "???-1", "loneliness and isolation","insecurities rooted in prejudice", "feeling aimless, lack of purpose", "family, stressors related to hispanic indiv", "providing for family", "words to describe mental state?", "mental health", "frustration, physical reactions", " mistakes, disappointment, probing your worth", "???-2", "stress related to manual labor", "Lack of control", "sexism, racism, money")
# topics <- c("making mistakes", "relationship", "working long hours", "helplessness", "race words", "finances - family", "family - tradition", "comparing to others", "???9", "pressure form job", "unemployment", "racism", "???13", "work relatonship", "ovewhelmed from work", "???16", "helplessness", "???18", "???19", "fighting discrimination", "physical stress", "concern for future", "stress", "overworked", "loneliness")
topics <- c("making mistakes", "relationship", "working long hours", "helplessness", "race words", "finances - family", "family - tradition", "comparing to others", "pressure form job", "unemployment", "racism",  "work relatonship", "ovewhelmed from work", "helplessness", "fighting discrimination", "physical stress", "concern for future", "stress", "overworked", "loneliness")
topic_names = c(1,2,3,4,5,6,7,8,10,11,12,14,15,17,20,21,22,23,24,25)


```

```{r}
plot(model_depression, type = "summary", xlim = c(0, 0.3))
plot(prep_gender, covariate = "gender", model = model_depression, method = "difference", 
     cov.value1 = "Male", cov.value2 = "Female",
     xlab = "More Female ... More Male",
     labeltype = "custom",
     custom.labels = topics,
     xlim = c(-0.1, 0.1),
     topics = topic_names,
     main = "Effect of Gender")


```

```{r}
plot(prep_eth, covariate = "race", model = model_depression, method = "difference", 
     cov.value1 = "White", cov.value2 = "PoC",
     xlab = "More PoC ... More White",
     labeltype = "custom",
     custom.labels = topics,
     xlim = c(-0.05, 0.05),
     ylim = c(0, 20),
     topics = topic_names,
     main = "Effect of Race")


```

```{r}
plot(prep_eth, covariate = "race", model = model_depression, method = "difference", 
     cov.value1 = "white", cov.value2 = "black",
     xlab = "More African American ... More white",
     labeltype = "custom",
     custom.labels = topics,
     topics = topic_names,
     xlim = c(-0.20, 0.20),
     )
plot(prep_eth, covariate = "race", model = model_depression, method = "difference", 
     cov.value1 = "white", cov.value2 = "asian",
     xlab = "More Asian ... More white",
     labeltype = "custom",
     custom.labels = topics,
     topics = topic_names,
     xlim = c(-0.20, 0.20),
     )
plot(prep_eth, covariate = "race", model = model_depression, method = "difference", 
     cov.value1 = "white", cov.value2 = "hispanic",
     xlab = "More hispanic ... More white",
     labeltype = "custom",
     custom.labels = topics,
     topics = topic_names,
     xlim = c(-0.20, 0.20),
     )


```

---
title: "R Notebook"
output: html_notebook
---

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. 

Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Cmd+Shift+Enter*. 

```{r}
## Installs
install.packages("stm")
install.packages("quanteda")
install.packages("spacyr")
install.packages("wordcloud")

## Imports


library(jsonlite)
library(stm)
library(quanteda)
library(spacyr)
library(stringr)
library(wordcloud)
library(ggplot2)

```

```{r}
gender_func <- function(gender_label){
  if(gender_label == "woman"){
    return("Female")
  } else if(gender_label == "man") {
    return("Male")
  } else {
    return("other")
  }
}

w_vs <- function(eth_label){
  if(eth_label == 'white'){
    return("White")
  } else {
    return("Not White")
  }
}
a_vs <- function(eth_label){
  if(eth_label == 'asian'){
    return("Asian")
  } else {
    return("Not Asian")
  }
}

b_vs <- function(eth_label){
  if(eth_label == 'black'){
    return("African American")
  } else {
    return("Not African American")
  }
}
h_vs <- function(eth_label){
  if(eth_label == 'hispanic'){
    return("Hispanic")
  } else {
    return("Not Hispanic")
  }
}
```


```{r}
# survey_meta <- read.csv("/Users/shinkamori/Documents/Research/p2345.csv")
survey_meta <- read.csv("/Users/shinkamori/Documents/Research/p2_p4_p5_p6_p7.csv")
survey_meta <- read.csv("/Users/shinkamori/Documents/Research/p4_5_6_7.csv")
survey_meta$gender <- sapply(survey_meta$gender, gender_func)
# survey_meta$w_vs <- sapply(survey_meta$race, w_vs)
# survey_meta$a_vs <- sapply(survey_meta$race, a_vs)
# survey_meta$b_vs <- sapply(survey_meta$race, b_vs)
# survey_meta$h_vs <- sapply(survey_meta$race, h_vs)

# survey_meta <- survey_meta[, c("text", "gender", "race")]
```
```{r}
summary(survey_meta)
```
```{r}
head(survey_metagit merge origin)
```

```{r}
sapply(lapply(survey_meta, unique), length)
```


```{r}
processed <- textProcessor(survey_meta$text, metadata=survey_meta[, c( "gender", "race")])
out <- prepDocuments(processed$documents, processed$vocab, processed$meta)
```
```{r}
sapply(lapply(processed$meta, unique), length)

```
```{r}
temp_text <- survey_meta[-processed$docs.removed,]

```
```{r}
length(temp_text)
```
```{r}
model_depression_race <- stm::stm(
  documents = out_race$documents,
  K = 25,
  prevalence =~ gender + w_vs ,
  data=out_race$meta,
  vocab = out_race$vocab,
  max.em.its=75
)


```
```{r}
model_depression_race_2 <- stm::stm(
  documents = out_race$documents,
  K = 25,
  prevalence =~ gender + race ,
  data=out_race$meta,
  vocab = out_race$vocab,
  max.em.its=75
)

```


```{r}
model_depression <- stm::stm(
  documents = out$documents,
  K = 25,
  prevalence =~ gender + race,
  data=out$meta,
  vocab = out$vocab,
  max.em.its=75
)
```
```{r}
labelTopics(model_depression_race_2, n = 30)

```
```{r}
labelTopics(model_depression, n = 30)

```

```{r}
labelTopics(model_depression, n = 30)

```
```{r}
findThoughts(model_depression, texts = survey_meta$text,topics = 4)# plots cloud of most important words

```

```{r}
labelTopics(model_depression, topics = 25, n=30)
findThoughts(model_depression, texts = survey_meta$text,topics = 25)# plots cloud of most important words
cloud(model_depression, 25)
# plotQuote(thoughts, width = 30, main = "Topic 2")
```
```{r}
prep_gender <- stm::estimateEffect(~ gender, 
                                   model_depression,
                                   meta = survey_meta[, c( "gender", "race")], uncertainty = "Global")

prep_eth <- stm::estimateEffect(~ race,
                                model_depression,
                                meta = survey_meta[, c( "gender", "race")], uncertainty = "Global")
prep_w_vs <- stm::estimateEffect(~ w_vs,
                                model_depression,
                                meta = survey_meta[, c( "gender", "race")], uncertainty = "Global")
```



```{r}
# topics <- c("finances, relationships", "feeling stuck", "politics and news","talent and success?", "high pressure from work", "work life balance", "police brutality??", "stressors related to asian indiv", "finance and stress from job", "racism, discrimination", "feeling inadequate, comparing to others", "???-1", "loneliness and isolation","insecurities rooted in prejudice", "feeling aimless, lack of purpose", "family, stressors related to hispanic indiv", "providing for family", "words to describe mental state?", "mental health", "frustration, physical reactions", " mistakes, disappointment, probing your worth", "???-2", "stress related to manual labor", "Lack of control", "sexism, racism, money")
# topics <- c("making mistakes", "relationship", "working long hours", "helplessness", "race words", "finances - family", "family - tradition", "comparing to others", "???9", "pressure form job", "unemployment", "racism", "???13", "work relatonship", "ovewhelmed from work", "???16", "helplessness", "???18", "???19", "fighting discrimination", "physical stress", "concern for future", "stress", "overworked", "loneliness")
topics <- c("making mistakes", "relationship", "working long hours", "helplessness", "race words", "finances - family", "family - tradition", "comparing to others", "pressure form job", "unemployment", "racism",  "work relatonship", "ovewhelmed from work", "helplessness", "fighting discrimination", "physical stress", "concern for future", "stress", "overworked", "loneliness")
topic_names = c(1,2,3,4,5,6,7,8,10,11,12,14,15,17,20,21,22,23,24,25)


```

```{r}
plot(model_depression, type = "summary", xlim = c(0, 0.3))
plot(prep_gender, covariate = "gender", model = model_depression, method = "difference", 
     cov.value1 = "Male", cov.value2 = "Female",
     xlab = "More Female ... More Male",
     labeltype = "custom",
     custom.labels = topics,
     xlim = c(-0.1, 0.1),
     topics = topic_names,
     main = "Effect of Gender")


```

```{r}
plot(prep_eth, covariate = "race", model = model_depression, method = "difference", 
     cov.value1 = "White", cov.value2 = "PoC",
     xlab = "More PoC ... More White",
     labeltype = "custom",
     custom.labels = topics,
     xlim = c(-0.05, 0.05),
     ylim = c(0, 20),
     topics = topic_names,
     main = "Effect of Race")


```

```{r}
plot(prep_eth, covariate = "race", model = model_depression, method = "difference", 
     cov.value1 = "black", cov.value2 = "white",
     xlab = "More White ... More African American",
     labeltype = "custom",
     custom.labels = topics,
     topics = topic_names,
     xlim = c(-0.20, 0.20),
     )
plot(prep_eth, covariate = "race", model = model_depression, method = "difference", 
     cov.value1 = "asian", cov.value2 = "white",
     xlab = "More White ... More Asian",
     labeltype = "custom",
     custom.labels = topics,
     topics = topic_names,
     xlim = c(-0.20, 0.20),
     )
plot(prep_eth, covariate = "race", model = model_depression, method = "difference", 
     cov.value1 = "hispanic", cov.value2 = "white",
     xlab = "More White ... More Hispanic",
     labeltype = "custom",
     custom.labels = topics,
     topics = topic_names,
     xlim = c(-0.20, 0.20),
     )


```

```{r}
toLDAvis(model_depression, out$documents)
```
```{r}
install.packages("LDAvis")

```


```{r}
plot(prep_eth, covariate = "race", model = model_depression, method = "difference", 
     cov.value1 = "asian", cov.value2 = "black",
     xlab = "More African American ... More Asian",
     labeltype = "custom",
     custom.labels = topics,
     topics = topic_names,
     xlim = c(-0.20, 0.20),
     )
plot(prep_eth, covariate = "race", model = model_depression, method = "difference", 
     cov.value1 = "hispanic", cov.value2 = "black",
     xlab = "More African American ... More Hispanic",
     labeltype = "custom",
     custom.labels = topics,
     xlim = c(-0.20, 0.20),
     topics = topic_names
     )
plot(prep_eth, covariate = "race", model = model_depression, method = "difference", 
     cov.value1 = "white", cov.value2 = "black",
     xlab = "More African American ... More White",
     labeltype = "custom",
     custom.labels = topics,
     xlim = c(-0.20, 0.20),
     topics = topic_names
     )


```



``````{r}
topicQuality(
  model_depression,
  out$documents,
  xlab = "Semantic Coherence",
  ylab = "Exclusivity",
 labels = topics,
  M = 20
)
```

e *Insert Chunk* button on the toolbar or by pressing *Cmd+Option+I*.

When you save the notebook, an HTML file containing the code and output will be saved alongside it (click the *Preview* button or press *Cmd+Shift+K* to preview the HTML file). 

The preview shows you a rendered HTML copy of the contents of the editor. Consequently, unlike *Knit*, *Preview* does not run any R code chunks. Instead, the output of the chunk when it was last run in the editor is displayed.





```{r}
toLDAvis(model_depression, out$documents)
```
```{r}
install.packages("LDAvis")

```


```{r}
plot(prep_eth, covariate = "race", model = model_depression, method = "difference", 
     cov.value1 = "asian", cov.value2 = "hispanic",
     xlab = "More Hispanic ... More Asian",
     labeltype = "custom",
     custom.labels = topics,
     topics = topic_names,
     
     xlim = c(-0.20, 0.20),
     )
plot(prep_eth, covariate = "race", model = model_depression, method = "difference", 
     cov.value1 = "black", cov.value2 = "hispanic",
     xlab = "More Hispanic ... More African American",
     labeltype = "custom",
     custom.labels = topics,
     xlim = c(-0.20, 0.20),
     topics = topic_names,
     )
plot(prep_eth, covariate = "race", model = model_depression, method = "difference", 
     cov.value1 = "white", cov.value2 = "hispanic",
     xlab = "More Hispanic ... More White",
     labeltype = "custom",
     custom.labels = topics,
     xlim = c(-0.20, 0.20),
     topics = topic_names
     )


```
```{r}
plot(prep_eth, covariate = "race", model = model_depression, method = "difference", 
     cov.value1 = "white", cov.value2 = "asian",
     xlab = "More Asian ... More White",
     labeltype = "custom",
     custom.labels = topics,
      topics = topic_names,
     xlim = c(-0.20, 0.20),
     )
plot(prep_eth, covariate = "race", model = model_depression, method = "difference", 
     cov.value1 = "black", cov.value2 = "asian",
     xlab = "More Asian ... More African American",
     labeltype = "custom",
     custom.labels = topics,
      topics = topic_names,
     xlim = c(-0.20, 0.20),
     )
plot(prep_eth, covariate = "race", model = model_depression, method = "difference", 
     cov.value1 = "hispanic", cov.value2 = "asian",
     xlab = "More Asian ... More Hispanic",
     labeltype = "custom",
     custom.labels = topics,
      topics = topic_names,
     xlim = c(-0.20, 0.20),
     )
```
```{r}
(semanticCoherence(model_depression, out$documents, M = 30))
```



``````{r}
topicQuality(
  model_depression,
  out$documents,
  xlab = "Semantic Coherence",
  ylab = "Exclusivity",
 labels = topics,
  M = 20
)
```

e *Insert Chunk* button on the toolbar or by pressing *Cmd+Option+I*.

When you save the notebook, an HTML file containing the code and output will be saved alongside it (click the *Preview* button or press *Cmd+Shift+K* to preview the HTML file). 

The preview shows you a rendered HTML copy of the contents of the editor. Consequently, unlike *Knit*, *Preview* does not run any R code chunks. Instead, the output of the chunk when it was last run in the editor is displayed.



``````{r}
topicQuality(
  model_depression,
  out$documents,
  xlab = "Semantic Coherence",
  ylab = "Exclusivity",
 labels = topics,
  M = 20
)
```

e *Insert Chunk* button on the toolbar or by pressing *Cmd+Option+I*.

When you save the notebook, an HTML file containing the code and output will be saved alongside it (click the *Preview* button or press *Cmd+Shift+K* to preview the HTML file). 

The preview shows you a rendered HTML copy of the contents of the editor. Consequently, unlike *Knit*, *Preview* does not run any R code chunks. Instead, the output of the chunk when it was last run in the editor is displayed.





```{r}
toLDAvis(model_depression, out$documents)
```
```{r}
install.packages("LDAvis")

```


```{r}
plot(prep_eth, covariate = "race", model = model_depression, method = "difference", 
     cov.value1 = "asian", cov.value2 = "black",
     xlab = "More African American ... More Asian",
     labeltype = "custom",
     custom.labels = topics,
     
     xlim = c(-0.10, 0.10),
     )
plot(prep_eth, covariate = "race", model = model_depression, method = "difference", 
     cov.value1 = "hispanic", cov.value2 = "black",
     xlab = "More African American ... More Hispanic",
     labeltype = "custom",
     custom.labels = topics,
     xlim = c(-0.10, 0.10),
     )
plot(prep_eth, covariate = "race", model = model_depression, method = "difference", 
     cov.value1 = "asian", cov.value2 = "hispanic",
     xlab = "More hispanic ... More Asian",
     labeltype = "custom",
     custom.labels = topics,
     xlim = c(-0.10, 0.10),
     )


```
```{r}
(semanticCoherence(model_depression, out$documents, M = 30))
```



``````{r}
topicQuality(
  model_depression,
  out$documents,
  xlab = "Semantic Coherence",
  ylab = "Exclusivity",
 labels = topics,
  M = 20
)
```

e *Insert Chunk* button on the toolbar or by pressing *Cmd+Option+I*.

When you save the notebook, an HTML file containing the code and output will be saved alongside it (click the *Preview* button or press *Cmd+Shift+K* to preview the HTML file). 

The preview shows you a rendered HTML copy of the contents of the editor. Consequently, unlike *Knit*, *Preview* does not run any R code chunks. Instead, the output of the chunk when it was last run in the editor is displayed.

